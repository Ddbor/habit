(self.webpackChunk_ddbor_habit=self.webpackChunk_ddbor_habit||[]).push([[646],{59646:function(R,te,r){"use strict";r.r(te),r.d(te,{HabitColumnSetting:function(){return ze},HabitRangePicker:function(){return ye},groupHabitColumns:function(){return pe},habitColumnsCopy:function(){return $},habitSortColumns:function(){return Y},sortGroupHabitColumns:function(){return ge}});var re=r(57213),c=r.n(re),T=r(54306),h=r.n(T),M=r(91747),J=r(12254),O=r(58179),ie=r(76106),Se=r(89155),ve=r(7637),he=r(33970),a=r(85170),je=r(74637),j=r.n(je),e=r(43010),le=function(){return[{label:"\u4ECA\u65E5",value:[j()(),j()()]},{label:"\u6628\u65E5",value:[j()().subtract(1,"d"),j()().subtract(1,"d")]}]},ye=function(n){var t=n.value,d=n.popoverProps,b=n.buttonProps,v=n.presetsButtonProps,x=n.subtmitButtonProps,C=n.cancelButtonProps,f=n.presets,A=n.startDatePickerProps,G=n.endDatePickerProps,K=n.format,E=K===void 0?"YYYY-MM-DD":K,y=n.compared,w=n.onChange,B=(0,a.useState)(["",""]),L=h()(B,2),i=L[0],I=L[1],D=(0,a.useState)(t),V=h()(D,2),p=V[0],P=V[1],Q=(0,a.useState)(["",""]),U=h()(Q,2),H=U[0],X=U[1],ue=(0,a.useState)(!1),ae=h()(ue,2),q=ae[0],_=ae[1],z=(0,a.useMemo)(function(){return typeof y=="boolean"},[y]),ce=(0,a.useState)(""),se=h()(ce,2),l=se[0],s=se[1],S=(0,a.useState)(!1),g=h()(S,2),k=g[0],N=g[1];(0,a.useEffect)(function(){N(z?y:null)},[y,q]);var F=(0,a.useMemo)(function(){return z&&!y},[z,y]),oe=(0,a.useMemo)(function(){return q?180:0},[q]),W=(0,a.useMemo)(function(){var o,u;if(z){var Z,de;return[((Z=le().find(function(ne){return j()(ne.value[0]).isSame(t[0],"d")}))===null||Z===void 0?void 0:Z.label)||i[0],F?"":((de=le().find(function(ne){return j()(ne.value[0]).isSame(t[1],"d")}))===null||de===void 0?void 0:de.label)||i[1]]}if(l)return[l,""];var Ce=(o=f||[])===null||o===void 0||(u=o.concat(le()).find(function(ne){return j()(ne.value[0]).isSame(t[0],"d")&&j()(ne.value[1]).isSame(t[1],"d")}))===null||u===void 0?void 0:u.label;return[Ce||i[0],Ce?"":i[1]]},[t,f,F,z,i,l]),ee=(0,a.useMemo)(function(){return{textAlign:W[1]?"center":"left"}},[W]),We=(0,a.useCallback)(function(o){return o?F?o>j()().endOf("d"):p[1]&&o>p[1]:!1},[p[1],F]),Ge=(0,a.useCallback)(function(o){return o&&(p[0]&&o<p[0]||o>j()().endOf("d"))},[p[0]]);(0,a.useEffect)(function(){P(t);var o=[j()(t[0]).format(E),j()(t[1]).format(E)];I(o),X(o)},[t]);var Le=function(u,Z){P([u,p[1]]),X([Z,H[1]])},Je=function(u,Z){P([p[0],u]),X([H[0],Z])},Ye=function(u){_(u)},Ke=function(){_(!1),w==null||w(p,H,k),s(null)},Ve=function(u){P(u.value);var Z=[j()(u.value[0]).format(E),j()(u.value[1]).format(E)];X(Z),_(!1),w==null||w(u.value,Z,k),s(u==null?void 0:u.label)},Qe=(0,a.useCallback)(function(){return f==null?void 0:f.map(function(o,u){return typeof o.label=="string"?(0,e.jsx)("div",{className:"habit-range-picker-popover-presets-item",children:(0,e.jsx)(O.ZP,c()(c()({type:"link",size:"small",style:{padding:0,textAlign:"left",width:"100%"},onClick:function(){return Ve(o)}},v),{},{children:o.label}))},u):o.label})},[f]);return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ie.Z,c()(c()({trigger:"click",placement:"bottom",open:q,getPopupContainer:function(u){return u},overlayInnerStyle:{padding:0}},d),{},{onOpenChange:Ye,content:(0,e.jsxs)("div",{className:"habit-range-picker-popover-content",children:[(0,e.jsxs)("div",{className:"habit-range-picker-popover-head",children:[(0,e.jsxs)("div",{className:"habit-range-picker-popover-head-title",children:[(0,e.jsx)("div",{children:"\u9009\u62E9\u65E5\u671F:"}),z&&(0,e.jsxs)("div",{className:"habit-range-picker-popover-head-switch",children:[(0,e.jsx)("span",{children:"\u5BF9\u6BD4"}),(0,e.jsx)(Se.Z,{size:"small",checked:!!k,onChange:function(u){return N(u)}})]})]}),(0,e.jsxs)("div",{className:"habit-range-picker-popover-date",children:[(0,e.jsx)(ve.Z,c()({showToday:!1,allowClear:!1,size:"small",value:p[0],disabledDate:We,onChange:Le},A)),(0,e.jsx)("span",{className:"habit-range-picker-popover-date-separator",children:"-"}),(0,e.jsx)(ve.Z,c()({showToday:!1,allowClear:!1,size:"small",placement:"bottomRight",value:p[1],disabledDate:Ge,onChange:Je,disabled:F},G))]})]}),(0,e.jsx)(he.Z,{style:{margin:0}}),f&&f.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"habit-range-picker-popover-presets",children:[(0,e.jsx)("div",{className:"habit-range-picker-popover-presets-title",children:"\u5FEB\u6377\u65E5\u671F:"}),(0,e.jsx)("div",{className:"habit-range-picker-popover-presets-list",children:Qe()})]}),(0,e.jsx)(he.Z,{style:{margin:0}})]}),(0,e.jsxs)("div",{className:"habit-range-picker-popover-footer",children:[(0,e.jsx)(O.ZP,c()(c()({type:"primary",size:"small",style:{marginRight:"8px"}},x),{},{onClick:function(){return Ke()},children:"\u786E\u5B9A"})),(0,e.jsx)(O.ZP,c()(c()({size:"small"},C),{},{onClick:function(){return _(!1)},children:"\u53D6\u6D88"}))]})]}),children:(0,e.jsx)("div",{className:"habit-range-picker",children:(0,e.jsx)(O.ZP,c()(c()({},b),{},{htmlType:"reset",onClick:function(){return _(!q)},children:(0,e.jsxs)("div",{className:"habit-range-picker-button",children:[(0,e.jsx)(M.Z,{style:{color:"#999"}}),(0,e.jsxs)("div",{className:"habit-range-picker-button-text",children:[(0,e.jsx)("span",{className:"habit-range-picker-button-text-item",style:ee,children:W[0]}),W[1]&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:"habit-range-picker-button-text-separator",children:z?"\u5BF9\u6BD4":"-"}),(0,e.jsx)("span",{className:"habit-range-picker-button-text-item",style:ee,children:W[1]})]})]}),(0,e.jsx)(J.Z,{style:{color:"#999",transform:"rotate(".concat(oe,"deg)"),transition:"all 0.3s"}})]})}))})}))})},ke=r(12342),Ne=r.n(ke),Pe=r(72657),Oe=r(26994),fe=r(19537),Ee=r(24213),we=r(80312),pe=function(n){return n.reduce(function(t,d){var b=d.properties.groupName,v=d.properties.groupOrder;return t[b]||(t[b]={groupName:b,groupOrder:v,columns:[]}),t[b].columns.push(d),t},{})},ge=function(n){return Object.values(pe(n)).sort(function(t,d){return t.groupOrder-d.groupOrder})},me=function(n){return typeof n.order=="number"?n.order:1/0},Y=function(n){return n.filter(function(t){return t.show}).sort(function(t,d){return me(t)-me(d)})},$=function(n){return n.map(function(t){return c()({},t)})},Be=(0,fe.W8)(function(m){var n=m.value;return(0,e.jsx)("div",{className:"habit-column-setting-drag-item",children:(0,e.jsx)(e.Fragment,{children:n==null?void 0:n.title})})}),De=(0,fe.JN)(function(m){var n=m.children;return(0,e.jsx)("div",{className:"habit-column-setting-drag-box",children:n})}),Fe=function(n){var t=n.dataSource,d=n.onSortEnd,b=(0,Ee.J)(function(v){var x=v.oldIndex,C=v.newIndex;if(x!==C){var f=(0,we.q)({array:$(t),fromIndex:x,toIndex:C});f.forEach(function(A,G){A.order=G}),d==null||d(f)}});return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(De,{lockAxis:"y",lockToContainerEdges:!0,onSortEnd:b,children:t.map(function(v,x){return(0,e.jsx)(Be,{index:x,value:v},v.key)})})})},xe=r(84947),Ze=r(3786),Re=r(87356),Te={color:"#ccc",cursor:"pointer",fontSize:"14px",marginLeft:"2px",verticalAlign:"middle"},be=function(n){return n.every(function(t){return t.show})},Ae=function(n){return n.some(function(t){return t.show})&&!be(n)},Ie=function(n,t){return!t||typeof n!="string"?!1:n.includes(t)},He=function(n){var t=n.dataSource,d=n.filterTitle,b=n.max,v=b===void 0?1/0:b,x=n.sortColumns,C=x===void 0?[]:x,f=n.onChange,A=(0,a.useState)([]),G=h()(A,2),K=G[0],E=G[1],y=(0,a.useMemo)(function(){return C.length>=v},[v,C]);(0,a.useEffect)(function(){E(ge($(t)))},[t]);var w=function(L,i){var I=L.target.checked,D=$(t),V=C.length;i.forEach(function(p){if(!(I&&V>=v||p!=null&&p.disable)){var P=D.findIndex(function(Q){return Q.key===p.key});D[P].show=I,I?V++:delete D[P].order}}),f==null||f(D)};return(0,e.jsx)(e.Fragment,{children:K.map(function(B,L){return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"habit-column-setting-left-cont-title",children:(0,e.jsx)(xe.Z,{indeterminate:Ae(B.columns),checked:be(B.columns),onChange:function(I){return w(I,B.columns)},children:(0,e.jsx)("span",{className:"habit-column-setting-checkbox-label",children:B.groupName})})}),(0,e.jsx)("div",{className:"habit-column-setting-checkbox-list clearfix",children:B.columns.map(function(i){return(0,e.jsxs)("div",{className:"habit-column-setting-checkbox-item ".concat(Ie(i.title,d)?"habit-column-setting-checkbox-item-active":""),children:[(0,e.jsx)(xe.Z,{checked:i.show,disabled:i.disable||y&&!i.show,onChange:function(D){return w(D,[i])},children:(0,e.jsx)("span",{className:"habit-column-setting-checkbox-label",children:i==null?void 0:i.title})}),i.description&&(0,e.jsx)(Ze.Z,{title:i.description,children:(0,e.jsx)(Re.Z,{style:Te})})]},i.key)})})]},L.toString())})})},Me=["columns","open","max","onOk","persistenceKey","persistenceType"],$e=Pe.Z.Search,ze=function(n){var t=n.columns,d=n.open,b=n.max,v=n.onOk,x=n.persistenceKey,C=n.persistenceType,f=Ne()(n,Me),A=f.onClose,G=(0,a.useState)([]),K=h()(G,2),E=K[0],y=K[1],w=(0,a.useState)([]),B=h()(w,2),L=B[0],i=B[1],I=(0,a.useState)(""),D=h()(I,2),V=D[0],p=D[1],P=(0,a.useRef)([]),Q=(0,a.useRef)([]),U=(0,a.useRef)(!0),H=(0,a.useMemo)(function(){return!x||!C||typeof window=="undefined"},[x,C]),X=(0,a.useCallback)(function(l){if(H)return l;var s=window[C];try{var S=s==null?void 0:s.getItem(x);if(S){var g=JSON.parse(S),k=$(l);return k.forEach(function(N){var F,oe,W,ee;N.show=(F=g==null||(oe=g[N.key])===null||oe===void 0?void 0:oe.show)!==null&&F!==void 0?F:N.show,N.order=(W=g==null||(ee=g[N.key])===null||ee===void 0?void 0:ee.order)!==null&&W!==void 0?W:N.order}),k}}catch(N){console.warn(N)}return l},[x,C,H]),ue=(0,a.useCallback)(function(l){if(!H){var s=window[C];try{var S=l.reduce(function(g,k){return g[k.key]={show:k.show,order:k.order},g},{});s==null||s.setItem(x,JSON.stringify(S))}catch(g){console.warn(g)}}},[x,C,H]),ae=function(s,S){return s.map(function(g){var k=S.find(function(F){return F.key===g.key}),N=c()(c()({},g),{},{show:!!k});return k&&(N.order=k.order),N})};(0,a.useEffect)(function(){if(d){var l=t;U.current&&(l=X(l),Q.current=l,U.current=!1),P.current=l,y(Y($(P.current))),i(P.current)}},[d,t]),(0,a.useEffect)(function(){if(!d&&U.current&&!H){var l=X(t);v==null||v(ae(l,Y($(l))))}},[U.current,H,d,t]);var q=function(s){p(s)},_=function(s){y(Y(s)),i(s)},z=function(){y(Y($(Q.current))),i(Q.current)},ce=function(){var s=$(P.current);s.forEach(function(S){S.disable||(S.show=!1,delete S.order)}),y(Y(s)),i(s)},se=function(s){var S=ae(P.current,E);ue(S),v==null||v(S),A==null||A(s)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Oe.Z,c()(c()({title:"\u9009\u62E9\u6570\u636E\u5B57\u6BB5",placement:"right",width:1e3,bodyStyle:{padding:"16px 24px",backgroundColor:"#f9f9f9"},footer:(0,e.jsxs)("div",{children:[(0,e.jsx)(O.ZP,{type:"primary",style:{marginRight:15},onClick:se,children:"\u786E\u5B9A"}),(0,e.jsx)(O.ZP,{type:"default",onClick:A,children:"\u53D6\u6D88"})]}),open:d},f),{},{children:(0,e.jsxs)("div",{className:"habit-column-setting-body",children:[(0,e.jsxs)("div",{className:"habit-column-setting-left",children:[(0,e.jsx)("div",{className:"habit-column-setting-left-head",children:(0,e.jsx)($e,{placeholder:"\u641C\u7D22\u6570\u636E\u5B57\u6BB5",allowClear:!0,style:{width:200},onSearch:q})}),(0,e.jsx)("div",{className:"habit-column-setting-left-cont",children:(0,e.jsx)(He,{max:b,sortColumns:E,dataSource:L,filterTitle:V,onChange:_})})]}),(0,e.jsxs)("div",{className:"habit-column-setting-right",children:[(0,e.jsxs)("div",{className:"habit-column-setting-right-head",children:[(0,e.jsxs)("span",{className:"habit-column-setting-checkbox-label",children:["\u5DF2\u9009\uFF08",E.length," ",b?"/".concat(b):null,"\uFF09\u9879"]}),(0,e.jsx)("a",{className:"habit-column-setting-right-a",onClick:ce,children:"\u6E05\u7A7A"}),(0,e.jsx)("a",{className:"habit-column-setting-right-a",onClick:z,children:"\u6062\u590D\u9ED8\u8BA4"})]}),(0,e.jsx)("div",{className:"habit-column-setting-right-alert",children:"\u62D6\u52A8\u4EE5\u4E0B\u5B57\u6BB5\u8FDB\u884C\u6392\u5E8F"}),(0,e.jsx)(Fe,{dataSource:E,onSortEnd:function(s){return y(Y(s))}})]})]})}))})}},12342:function(R,te,r){var re=r(20006);function c(T,h){if(T==null)return{};var M=re(T,h),J,O;if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(T);for(O=0;O<ie.length;O++)J=ie[O],!(h.indexOf(J)>=0)&&Object.prototype.propertyIsEnumerable.call(T,J)&&(M[J]=T[J])}return M}R.exports=c,R.exports.__esModule=!0,R.exports.default=R.exports},20006:function(R){function te(r,re){if(r==null)return{};var c={},T=Object.keys(r),h,M;for(M=0;M<T.length;M++)h=T[M],!(re.indexOf(h)>=0)&&(c[h]=r[h]);return c}R.exports=te,R.exports.__esModule=!0,R.exports.default=R.exports}}]);
