(self.webpackChunk_ddbor_habit=self.webpackChunk_ddbor_habit||[]).push([[646],{59646:function(F,ee,r){"use strict";r.r(ee),r.d(ee,{HabitColumnSetting:function(){return Ue},HabitRangePicker:function(){return Oe},groupHabitColumns:function(){return Se},habitColumnsCopy:function(){return G},habitSortColumns:function(){return Q},sortGroupHabitColumns:function(){return je}});var ne=r(57213),l=r.n(ne),T=r(54306),v=r.n(T),M=r(91747),K=r(12254),P=r(58179),le=r(76106),Ee=r(89155),xe=r(7637),be=r(33970),a=r(85170),Pe=r(74637),y=r.n(Pe),e=r(43010),he=function(){return[{label:"\u4ECA\u65E5",value:[y()(),y()()]},{label:"\u6628\u65E5",value:[y()().subtract(1,"d"),y()().subtract(1,"d")]}]},Oe=function(n){var t=n.value,c=n.popoverProps,C=n.buttonProps,h=n.presetsButtonProps,b=n.subtmitButtonProps,S=n.cancelButtonProps,f=n.presets,R=n.startDatePickerProps,Y=n.endDatePickerProps,V=n.format,O=V===void 0?"YYYY-MM-DD":V,k=n.compared,B=n.onChange,w=(0,a.useState)(["",""]),H=v()(w,2),i=H[0],Z=H[1],D=(0,a.useState)(t),z=v()(D,2),g=z[0],N=z[1],te=(0,a.useState)(["",""]),re=v()(te,2),L=re[0],X=re[1],pe=(0,a.useState)(!1),ae=v()(pe,2),U=ae[0],W=ae[1],m=(0,a.useMemo)(function(){return typeof k=="boolean"},[k]),fe=(0,a.useState)(""),ue=v()(fe,2),q=ue[0],ce=ue[1],ge=(0,a.useState)(!1),de=v()(ge,2),$=de[0],ve=de[1];(0,a.useEffect)(function(){ve(m?k:null)},[k,m]);var d=(0,a.useMemo)(function(){return m&&!k},[m,k]),s=(0,a.useMemo)(function(){return m&&!$},[m,$]),j=(0,a.useMemo)(function(){return U?180:0},[U]),p=(0,a.useMemo)(function(){var o,u;if(m){var I,me;return[((I=he().find(function(_){return y()(_.value[0]).isSame(t[0],"d")}))===null||I===void 0?void 0:I.label)||i[0],d?"":((me=he().find(function(_){return y()(_.value[0]).isSame(t[1],"d")}))===null||me===void 0?void 0:me.label)||i[1]]}if(q)return[q,""];var Ae=(o=f||[])===null||o===void 0||(u=o.concat(he()).find(function(_){return y()(_.value[0]).isSame(t[0],"d")&&y()(_.value[1]).isSame(t[1],"d")}))===null||u===void 0?void 0:u.label;return[Ae||i[0],Ae?"":i[1]]},[t,f,d,m,i,q]),A=(0,a.useMemo)(function(){return{textAlign:p[1]?"center":"left"}},[p]),E=(0,a.useCallback)(function(o){return o?s?o>y()().endOf("d"):g[1]&&o>g[1]:!1},[g[1],s]),J=(0,a.useCallback)(function(o){return o&&(g[0]&&o<g[0]||o>y()().endOf("d"))},[g[0]]);(0,a.useEffect)(function(){N(t);var o=[y()(t[0]).format(O),y()(t[1]).format(O)];Z(o),X(o)},[t]);var oe=function(u,I){N([u,g[1]]),X([I,L[1]])},se=function(u,I){N([g[0],u]),X([L[0],I])},ie=function(u){W(u)},$e=function(){W(!1),B==null||B(g,L,$),ce(null)},Je=function(u){N(u.value);var I=[y()(u.value[0]).format(O),y()(u.value[1]).format(O)];X(I),W(!1),B==null||B(u.value,I,$),ce(u==null?void 0:u.label)},Le=(0,a.useCallback)(function(){return f==null?void 0:f.map(function(o,u){return typeof o.label=="string"?(0,e.jsx)("div",{className:"habit-range-picker-popover-presets-item",children:(0,e.jsx)(P.ZP,l()(l()({type:"link",size:"small",style:{padding:0,textAlign:"left",width:"100%"},onClick:function(){return Je(o)}},h),{},{children:o.label}))},u):o.label})},[f]);return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(le.Z,l()(l()({trigger:"click",placement:"bottom",open:U,getPopupContainer:function(u){return u},overlayInnerStyle:{padding:0}},c),{},{onOpenChange:ie,content:(0,e.jsxs)("div",{className:"habit-range-picker-popover-content",children:[(0,e.jsxs)("div",{className:"habit-range-picker-popover-head",children:[(0,e.jsxs)("div",{className:"habit-range-picker-popover-head-title",children:[(0,e.jsx)("div",{children:"\u9009\u62E9\u65E5\u671F:"}),m&&(0,e.jsxs)("div",{className:"habit-range-picker-popover-head-switch",children:[(0,e.jsx)("span",{children:"\u5BF9\u6BD4"}),(0,e.jsx)(Ee.Z,{size:"small",checked:!!$,onChange:function(u){return ve(u)}})]})]}),(0,e.jsxs)("div",{className:"habit-range-picker-popover-date",children:[(0,e.jsx)(xe.Z,l()({showToday:!1,allowClear:!1,size:"small",value:g[0],disabledDate:E,onChange:oe},R)),(0,e.jsx)("span",{className:"habit-range-picker-popover-date-separator",children:"-"}),(0,e.jsx)(xe.Z,l()(l()({showToday:!1,allowClear:!1,size:"small",placement:"bottomRight",value:g[1],disabledDate:J,onChange:se},Y),{},{disabled:s}))]})]}),(0,e.jsx)(be.Z,{style:{margin:0}}),f&&f.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"habit-range-picker-popover-presets",children:[(0,e.jsx)("div",{className:"habit-range-picker-popover-presets-title",children:"\u5FEB\u6377\u65E5\u671F:"}),(0,e.jsx)("div",{className:"habit-range-picker-popover-presets-list",children:Le()})]}),(0,e.jsx)(be.Z,{style:{margin:0}})]}),(0,e.jsxs)("div",{className:"habit-range-picker-popover-footer",children:[(0,e.jsx)(P.ZP,l()(l()({type:"primary",size:"small",style:{marginRight:"8px"}},b),{},{onClick:function(){return $e()},children:"\u786E\u5B9A"})),(0,e.jsx)(P.ZP,l()(l()({size:"small"},S),{},{onClick:function(){return W(!1)},children:"\u53D6\u6D88"}))]})]}),children:(0,e.jsx)("div",{className:"habit-range-picker",children:(0,e.jsx)(P.ZP,l()(l()({},C),{},{htmlType:"reset",onClick:function(){return W(!U)},children:(0,e.jsxs)("div",{className:"habit-range-picker-button",children:[(0,e.jsx)(M.Z,{style:{color:"#999"}}),(0,e.jsxs)("div",{className:"habit-range-picker-button-text",children:[(0,e.jsx)("span",{className:"habit-range-picker-button-text-item",style:A,children:p[0]}),p[1]&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:"habit-range-picker-button-text-separator",children:m?"\u5BF9\u6BD4":"-"}),(0,e.jsx)("span",{className:"habit-range-picker-button-text-item",style:A,children:p[1]})]})]}),(0,e.jsx)(K.Z,{style:{color:"#999",transform:"rotate(".concat(j,"deg)"),transition:"all 0.3s"}})]})}))})}))})},Be=r(12342),we=r.n(Be),De=r(72657),Ie=r(26994),Ce=r(19537),Fe=r(24213),Te=r(80312),Se=function(n){return n.reduce(function(t,c){var C=c.properties.groupName,h=c.properties.groupOrder;return t[C]||(t[C]={groupName:C,groupOrder:h,columns:[]}),t[C].columns.push(c),t},{})},je=function(n){return Object.values(Se(n)).sort(function(t,c){return t.groupOrder-c.groupOrder})},ye=function(n){return typeof n.order=="number"?n.order:1/0},Q=function(n){return n.filter(function(t){return t.show}).sort(function(t,c){return ye(t)-ye(c)})},G=function(n){return n.map(function(t){return l()({},t)})},Re=(0,Ce.W8)(function(x){var n=x.value;return(0,e.jsx)("div",{className:"habit-column-setting-drag-item",style:{backgroundImage:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAUCAYAAACEYr13AAAAt0lEQVR4Ae3BQQ3EMAxE0d8MDRMKEUtGFMlESig0RtoiaA697ntXVU3bzUNSrrVuXlTVtN08JOWw3UAAYbs5sN1AAGG7Bx8NSQlsYEtKDiQlsIEtKfnjqqppu3lIyrXWzYuqmrabh6QcthsIIGw3B7YbCCBs9+CjISmBDWxJyYGkBDawJSV/XFU1bTcPSbnWunlRVdN285CUw3YDAYTt5sB2AwGE7R58NCQlsIEtKTmQlMAGtqT8AT13ZKKS1qIVAAAAAElFTkSuQmCC")'},children:(0,e.jsx)(e.Fragment,{children:n==null?void 0:n.title})})}),Ze=(0,Ce.JN)(function(x){var n=x.children;return(0,e.jsx)("div",{className:"habit-column-setting-drag-box",children:n})}),Me=function(n){var t=n.dataSource,c=n.onSortEnd,C=(0,Fe.J)(function(h){var b=h.oldIndex,S=h.newIndex;if(b!==S){var f=(0,Te.q)({array:G(t),fromIndex:b,toIndex:S});f.forEach(function(R,Y){R.order=Y}),c==null||c(f)}});return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Ze,{lockAxis:"y",lockToContainerEdges:!0,onSortEnd:C,children:t.map(function(h,b){return(0,e.jsx)(Re,{index:b,value:h},h.key)})})})},ke=r(84947),Ge=r(3786),Ye=r(87356),He={color:"#ccc",cursor:"pointer",fontSize:"14px",marginLeft:"2px",verticalAlign:"middle"},Ne=function(n){return n.every(function(t){return t.show})},We=function(n){return n.some(function(t){return t.show})&&!Ne(n)},Ke=function(n,t){return!t||typeof n!="string"?!1:n.includes(t)},Qe=function(n){var t=n.dataSource,c=n.filterTitle,C=n.max,h=C===void 0?1/0:C,b=n.sortColumns,S=b===void 0?[]:b,f=n.onChange,R=(0,a.useState)([]),Y=v()(R,2),V=Y[0],O=Y[1],k=(0,a.useMemo)(function(){return S.length>=h},[h,S]);(0,a.useEffect)(function(){O(je(G(t)))},[t]);var B=function(H,i){var Z=H.target.checked,D=G(t),z=S.length;i.forEach(function(g){if(!(Z&&z>=h||g!=null&&g.disable)){var N=D.findIndex(function(te){return te.key===g.key});D[N].show=Z,Z?z++:delete D[N].order}}),f==null||f(D)};return(0,e.jsx)(e.Fragment,{children:V.map(function(w,H){return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"habit-column-setting-left-cont-title",children:(0,e.jsx)(ke.Z,{indeterminate:We(w.columns),checked:Ne(w.columns),onChange:function(Z){return B(Z,w.columns)},children:(0,e.jsx)("span",{className:"habit-column-setting-checkbox-label",children:w.groupName})})}),(0,e.jsx)("div",{className:"habit-column-setting-checkbox-list clearfix",children:w.columns.map(function(i){return(0,e.jsxs)("div",{className:"habit-column-setting-checkbox-item ".concat(Ke(i.title,c)?"habit-column-setting-checkbox-item-active":""),children:[(0,e.jsx)(ke.Z,{checked:i.show,disabled:i.disable||k&&!i.show,onChange:function(D){return B(D,[i])},children:(0,e.jsx)("span",{className:"habit-column-setting-checkbox-label",children:i==null?void 0:i.title})}),i.description&&(0,e.jsx)(Ge.Z,{title:i.description,children:(0,e.jsx)(Ye.Z,{style:He})})]},i.key)})})]},H.toString())})})},Ve=["columns","open","max","onOk","persistenceKey","persistenceType"],ze=De.Z.Search,Ue=function(n){var t=n.columns,c=n.open,C=n.max,h=n.onOk,b=n.persistenceKey,S=n.persistenceType,f=we()(n,Ve),R=f.onClose,Y=(0,a.useState)([]),V=v()(Y,2),O=V[0],k=V[1],B=(0,a.useState)([]),w=v()(B,2),H=w[0],i=w[1],Z=(0,a.useState)(""),D=v()(Z,2),z=D[0],g=D[1],N=(0,a.useRef)([]),te=(0,a.useState)([]),re=v()(te,2),L=re[0],X=re[1],pe=(0,a.useState)(!0),ae=v()(pe,2),U=ae[0],W=ae[1],m=(0,a.useMemo)(function(){return!b||!S||typeof window=="undefined"},[b,S]),fe=(0,a.useCallback)(function(d){if(m)return d;var s=window[S];try{var j=s==null?void 0:s.getItem(b);if(j){var p=JSON.parse(j),A=G(d);return A.forEach(function(E){var J,oe,se,ie;E.show=(J=p==null||(oe=p[E.key])===null||oe===void 0?void 0:oe.show)!==null&&J!==void 0?J:E.show,E.order=(se=p==null||(ie=p[E.key])===null||ie===void 0?void 0:ie.order)!==null&&se!==void 0?se:E.order}),A}}catch(E){console.warn(E)}return d},[b,S,m]),ue=(0,a.useCallback)(function(d){if(!m){var s=window[S];try{var j=d.reduce(function(p,A){return p[A.key]={show:A.show,order:A.order},p},{});s==null||s.setItem(b,JSON.stringify(j))}catch(p){console.warn(p)}}},[b,S,m]),q=function(s,j){return s.map(function(p){var A=j.find(function(J){return J.key===p.key}),E=l()(l()({},p),{},{show:!!A});return A&&(E.order=A.order),E})};(0,a.useEffect)(function(){if(c){var d=t;N.current=d,W(!1),k(Q(G(N.current))),i(N.current)}},[c,t]),(0,a.useEffect)(function(){if(!c&&U&&!m){var d=fe(t);X(d),W(!1),h==null||h(q(d,Q(G(d))))}},[U,m,c,t]);var ce=function(s){g(s)},ge=function(s){k(Q(s)),i(s)},de=function(){k(Q(G(L))),i(L)},$=function(){var s=G(N.current);s.forEach(function(j){j.disable||(j.show=!1,delete j.order)}),k(Q(s)),i(s)},ve=function(s){var j=q(N.current,O);ue(j),h==null||h(j),R==null||R(s)};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Ie.Z,l()(l()({title:"\u9009\u62E9\u6570\u636E\u5B57\u6BB5",placement:"right",width:1e3,bodyStyle:{padding:"16px 24px",backgroundColor:"#f9f9f9"},footer:(0,e.jsxs)("div",{children:[(0,e.jsx)(P.ZP,{type:"primary",style:{marginRight:15},onClick:ve,children:"\u786E\u5B9A"}),(0,e.jsx)(P.ZP,{type:"default",onClick:R,children:"\u53D6\u6D88"})]}),open:c},f),{},{children:(0,e.jsxs)("div",{className:"habit-column-setting-body",children:[(0,e.jsxs)("div",{className:"habit-column-setting-left",children:[(0,e.jsx)("div",{className:"habit-column-setting-left-head",children:(0,e.jsx)(ze,{placeholder:"\u641C\u7D22\u6570\u636E\u5B57\u6BB5",allowClear:!0,style:{width:200},onSearch:ce})}),(0,e.jsx)("div",{className:"habit-column-setting-left-cont",children:(0,e.jsx)(Qe,{max:C,sortColumns:O,dataSource:H,filterTitle:z,onChange:ge})})]}),(0,e.jsxs)("div",{className:"habit-column-setting-right",children:[(0,e.jsxs)("div",{className:"habit-column-setting-right-head",children:[(0,e.jsxs)("span",{className:"habit-column-setting-checkbox-label",children:["\u5DF2\u9009\uFF08",O.length," ",C?"/".concat(C):null,"\uFF09\u9879"]}),(0,e.jsx)("a",{className:"habit-column-setting-right-a",onClick:$,children:"\u6E05\u7A7A"}),(0,e.jsx)("a",{className:"habit-column-setting-right-a",onClick:de,children:"\u6062\u590D\u9ED8\u8BA4"})]}),(0,e.jsx)("div",{className:"habit-column-setting-right-alert",children:"\u62D6\u52A8\u4EE5\u4E0B\u5B57\u6BB5\u8FDB\u884C\u6392\u5E8F"}),(0,e.jsx)(Me,{dataSource:O,onSortEnd:function(s){return k(Q(s))}})]})]})}))})}},12342:function(F,ee,r){var ne=r(20006);function l(T,v){if(T==null)return{};var M=ne(T,v),K,P;if(Object.getOwnPropertySymbols){var le=Object.getOwnPropertySymbols(T);for(P=0;P<le.length;P++)K=le[P],!(v.indexOf(K)>=0)&&Object.prototype.propertyIsEnumerable.call(T,K)&&(M[K]=T[K])}return M}F.exports=l,F.exports.__esModule=!0,F.exports.default=F.exports},20006:function(F){function ee(r,ne){if(r==null)return{};var l={},T=Object.keys(r),v,M;for(M=0;M<T.length;M++)v=T[M],!(ne.indexOf(v)>=0)&&(l[v]=r[v]);return l}F.exports=ee,F.exports.__esModule=!0,F.exports.default=F.exports}}]);
